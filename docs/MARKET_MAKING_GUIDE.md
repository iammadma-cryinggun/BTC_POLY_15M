# 做市策略使用指南

> **Polymarket Market Making Strategy**
>
> **日期**: 2026-01-28
> **版本**: v1.0

---

## 📋 目录

1. [策略概述](#策略概述)
2. [快速开始](#快速开始)
3. [配置说明](#配置说明)
4. [运行模式](#运行模式)
5. [监控和日志](#监控和日志)
6. [风险提示](#风险提示)

---

## 1. 策略概述

### **1.1 什么是做市策略？**

做市策略（Market Making）是指同时挂买单和卖单，通过赚取买卖价差来获利。

```
订单簿示例:
ASK: 0.62 x 100  ← 我们的卖单
BID: 0.58 x 100  ← 我们的买单
      ↑
    中间价 0.60

价差: (0.62 - 0.58) / 0.60 = 6.67%
```

### **1.2 为什么适合 Polymarket？**

| 特性 | 优势 |
|------|------|
| **低流动性** | 我们提供流动性，赚取溢价 ✅ |
| **大价差** | 正常 2-5%，利润空间大 ✅ |
| **FOK/IOC** | 快速成交，减少持仓时间 ✅ |
| **事件驱动** | 事件前后价差更大 ✅ |

### **1.3 核心功能**

1. **同时挂买单和卖单**（赚取价差）
2. **库存管理**（Skew 倾斜，保持中性）
3. **动态价差**（根据波动率调整）
4. **风险控制**（库存限制、波动率保护）
5. **自动对冲**（库存过多时对冲）

---

## 2. 快速开始

### **2.1 安装依赖**

```bash
cd D:\翻倍项目\polymarket_v2

pip install -r requirements.txt
```

### **2.2 配置环境变量**

```bash
# Windows (PowerShell)
$env:POLYMARKET_PK="0x你的私钥"

# Linux/Mac
export POLYMARKET_PK="0x你的私钥"
```

### **2.3 运行策略**

```bash
# 模拟模式（推荐测试）
python run_market_making.py --mode paper

# 查看帮助
python run_market_making.py --help
```

---

## 3. 配置说明

### **3.1 核心参数**

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `base_spread` | 0.02 (2%) | 基础价差 |
| `order_size` | 20 | 每单大小（个） |
| `max_inventory` | 200 | 最大库存（个） |
| `inventory_skew_factor` | 0.0001 | 库存倾斜因子 |
| `hedge_threshold` | 80 | 对冲阈值（个） |
| `max_volatility` | 0.15 (15%) | 最大波动率限制 |

### **3.2 价差参数**

```python
# 保守配置（利润大，成交少）
base_spread = 0.03      # 3%
order_size = 10         # 小单

# 激进配置（利润小，成交多）
base_spread = 0.01      # 1%
order_size = 50         # 大单

# 事件期配置
event_spread = 0.08     # 8%
event_order_size = 10   # 小单
```

### **3.3 库存参数**

```python
# 库存倾斜
# 持有过多 YES → 降低买价，提高卖价 → 鼓励卖出
# 持有过多 NO → 提高买价，降低卖价 → 鼓励买入

inventory_skew_factor = 0.0001  # 倾斜强度
max_skew = 0.02                  # 最大倾斜 2%
```

---

## 4. 运行模式

### **4.1 Paper Trading（模拟）**

```bash
python run_market_making.py --mode paper
```

**特点**:
- ✅ 不真实下单
- ✅ 测试策略逻辑
- ✅ 验证参数设置
- ✅ 零风险测试

### **4.2 Portfolio（真实交易）**

```bash
python run_market_making.py --mode portfolio
```

**特点**:
- ⚠️ 真实下单
- ⚠️ 真实盈亏
- ⚠️ 需要资金

**建议**:
- 先用 Paper Trading 测试 1-2 周
- 确认策略稳定后再用真实资金
- 从小资金开始（如 100 USDC）

### **4.3 Both（双轨对比）**

```bash
python run_market_making.py --mode both
```

**特点**:
- 同时运行 Paper 和 Portfolio
- 对比模拟和真实表现
- 验证策略一致性

---

## 5. 监控和日志

### **5.1 实时日志**

```bash
# 查看实时日志
tail -f logs/market-making-$(date +%Y%m%d).log
```

**关键日志信息**:

```
============================================================
做市参数:
  中间价: 0.6000
  价差: 2.00%
  倾斜: 1.00%
  买价: 0.5820
  卖价: 0.6180
  订单大小: 20个
============================================================
```

### **5.2 监控指标**

**关键指标**:
- 价差收益率
- 成交率
- 库存水平
- 总盈亏
- 最大回撤

### **5.3 Web 监控**

如果启用了 Web 监控（需要额外实现）：

```bash
# 访问 Web 界面
http://localhost:8080

# 查看当前状态
curl http://localhost:8080/api/state
```

---

## 6. 风险提示

### **6.1 策略风险**

| 风险 | 说明 | 缓解措施 |
|------|------|---------|
| **库存风险** | 价格向不利方向移动 | 使用 Skew 倾斜，自动对冲 |
| **价格跳跃** | 事件发生时价格跳跃 10-20% | 设置最大波动率限制 |
| **低流动性** | 大单可能无法成交 | 使用 IOC 订单，动态调整大小 |
| **价差收窄** | 价差可能缩小到 0.5% | 设置最小价差限制 |

### **6.2 使用建议**

1. **从小资金开始**
   - 建议起始资金: 100-200 USDC
   - 订单大小: 10-20 个
   - 最大库存: 100 个

2. **充分测试**
   - Paper Trading 至少 1-2 周
   - 观察成交率和盈亏
   - 调整参数

3. **监控和调整**
   - 定期检查库存水平
   - 观察成交率
   - 根据市场情况调整价差

4. **风险控制**
   - 设置最大库存限制
   - 设置最大日亏损
   - 使用自动对冲

### **6.3 不适用场景**

❌ **不适合使用做市策略的情况**:
- 极端事件期（价格剧烈波动）
- 市场即将结算（流动性枯竭）
- 单边行情（价格持续上涨或下跌）
- 自己的库存已经很大

✅ **适合使用的情况**:
- 价格相对稳定
- 有足够的流动性
- 订单簿深度适中
- 事件前后（价差大）

---

## 7. 预期收益

### **7.1 保守估计**

假设:
- 平均价差: 2%
- 成交率: 30% (FOK/IOC 订单)
- 每天交易: 100 次
- 订单大小: 20 个
- 平均价格: 0.60

**计算**:
```
每笔利润 = 20 * 0.60 * 0.02 = 0.24 USDC
每天利润 = 100 * 0.24 * 0.3 = 7.2 USDC
每月利润 = 7.2 * 30 = 216 USDC
```

**收益率** (假设本金 1000 USDC):
```
月收益率 = 216 / 1000 = 21.6%
年收益率 = 21.6% * 12 = 259.2%
```

### **7.2 风险指标**

| 指标 | 预期值 |
|------|--------|
| 最大回撤 | -10% 到 -20% |
| 夏普比率 | 0.8 到 1.2 |
| 胜率 | 65% 到 70% |
| 盈亏比 | 1.5 到 2.0 |

---

## 8. 常见问题

### **Q1: 为什么订单总是不成交？**

**A**: 可能的原因:
1. 价差太大 → 降低 `base_spread`
2. 订单太大 → 降低 `order_size`
3. 订单簿深度太浅 → 使用 `IOC` 而不是 `FOK`

### **Q2: 库存一直累积怎么办？**

**A**:
1. 检查 `inventory_skew_factor` 设置
2. 降低 `max_inventory` 限制
3. 策略会自动对冲（达到 `hedge_threshold`）

### **Q3: 策略会亏损吗？**

**A**: 会。可能的原因:
1. 价格持续向不利方向移动
2. 库存累积后价格跳跃
3. 事件期价格剧烈波动

**缓解措施**:
- 使用 Skew 倾斜
- 设置止损
- 限制最大库存
- 设置最大日亏损

### **Q4: 什么时候停止策略？**

**A**: 建议停止的情况:
1. 市场即将结算（流动性枯竭）
2. 极端事件期（波动率 > 20%）
3. 达到最大日亏损
4. 自己的库存已达上限

---

## 9. 下一步

### **立即行动**

1. **阅读文档**
   - `docs/MARKET_MAKING_STRATEGY.md` - 策略设计文档
   - `docs/INFRASTRUCTURE_ANALYSIS.md` - 基础设施分析

2. **配置参数**
   - 根据自己的资金调整 `order_size`
   - 根据风险承受能力调整 `base_spread`

3. **测试运行**
   - 先用 Paper Trading 测试
   - 观察日志和成交率
   - 调整参数

### **优化方向**

1. **短期** (1-2周)
   - 调整价差和订单大小
   - 优化 Skew 参数
   - 观察成交率

2. **中期** (1-2月)
   - 实现事件检测
   - 动态调整参数
   - 优化对冲逻辑

3. **长期** (3-6月)
   - 机器学习优化
   - 多市场做市
   - 高级风险管理

---

**版本**: v1.0
**日期**: 2026-01-28
**作者**: Claude Code
**状态**: ✅ 已完成，待测试

**重要提示**:
- 先用 Paper Trading 充分测试
- 从小资金开始
- 密切监控和调整
- 祝交易顺利！
